# 进程与线程的区别

- 进程是资源分配的单位，线程是CPU调度的单位

- 进程一拥有完整资源的的平台，线程值独享必不可少的资源，如寄存器，栈，程序计数器

- 线程同样具有就绪，阻塞，运行三个基本状态，并且可以相互切换

- 线程可以减少并发执行的时间和空间的开销

  - 线程的创建时间比进程短
  - 线程的销毁时间比进程短
  - 同一进程内线程的切换时间比进程短
  - 由于同一进程的各线程共享进程的内存和文件资源，可直接进行不经过内核的通信

  ## 用户线程

  用户线程，在用户空间实现的线程机制，它不依赖操作系统的内核，由一组用户级的线程库函数来完成线程的管理，包括进程的创建、终止、同步和调度等。

  - （操作系统内核不知道有用户线程的存在）
  - 每个进程都需要他自己私有的线程控制块列表，用户跟踪记录它的各个线程的状态信息（PC，栈指针，寄存器），TCB由线程库函数来维护
  - 用户进程的切换也是由线程库函数来完成，无需用户态、核心态切换，所有速度特别快
  - 允许每个进程拥有自定义的线程调度算法
  - 缺点
    - 阻塞性的系统调用如何实现？如果一个线程发生系统调用阻塞，整个进程都在等待
    - 当一个线程开始运行后，除非它主动地交出CPU的使用权，否则它所在的进程中其它线程将无法运行
    - 由于时间片分配给进程，故与其它的进程比，在多线程执行下，每个线程得到的时间片较少，执行会慢

  ## 内核线程

  是指在操作系统的内核中实现的一种线程机制，由于操作系统完成线程的创建、终止和管理

  - 在支持内核线程的操作系统中，有内核来维护进程和线程的上下文切换
  - 线程的创建，终止、切换是通过系统调用/内核函数的方式来进行的，有内核完成，因此系统的开销较大
  - 在一个进程当中，如果某个内核线程发起调用而被阻塞，并不会影响其他内核线程的运行
  - 时间片分配给线程，多线程的进程获得更多的cpu时间

  ## 轻量级线程

  他是内核支持的用户线程。一个进程可有一个或多个轻量级进程。每个轻量级进程有一个单独的内核线程来维护



## 上下文切换

- 切换CPU的当前任务，从一个进程/线程到另一个
- 保存当前进程/线程在PCB/TCP中的执行上下文（CPU状态）
- 读取下一个进程/线程的上下文

## CPU调度

从就绪队列中挑选一个进程/线程作为CPU将要运行的下一个进程/线程

调度程序，挑选进程/线程的内核函数

什么时候进行调度？进程状态切换产生调度

## 内核运行调度程序的条件

- 一个进程从运行状态切换到等待状态
- 一个进程被终结了

## 不可抢占

调度程序必须等待事件结束

## 可以抢占

- 调度程序在中断被相应后执行
- 当前的进程从运行切换到就绪，或者一个进程从等待切换到就绪状态
- 当前运行的进程可以别换出

