# Mysql数据库

IN 操作符一般比 OR 操作符清单执行更快。

正则表达式

![1531899443917](E:\mydairy\数据库\正则表达式.png)



## 索引

- 索引是在存储引擎层而不是服务器层实现，索引没有统一的索引标准，不同的存储引擎的索引的工作方式不同



## B-tree 索引

- InnoDB存储引擎使用B+树索引

MySQL 索引官方定义：索引是帮助Mysql高效获取数据的数据结构（索引是数据结构）（排好序的快速查找数据结构）

索引的目的在于提高查找效率，类比字典

索引会影响查找和排序

一般来说索引本身也很大，不能全部存储在内存中，因此索引以文件的形式存储在磁盘中

### 优势

- 索引大大减少了服务器需要扫描的数据量
- 索引可以帮助服务器避免排序了临时表
- 索引将随机IO变成顺序IO

- 类似大学图书馆建立书目索引，提高数据检索的效率，降低数据库的IO成本
- 通过索引对数据进行排序，降低排序的成本，降低了cpuD的消耗

### 劣势

- 实际上索引也是一种表，这表保存了主键与索引字段，并指向实体表记录，所以索引也占空间。
- 虽然索引大大提高了查询速度，同时却会件降低更新表的速度，如对表进行Insert,delete,和Update,因为更新表时，MYSQL不仅仅要保存数据，还要保存一下索引文件每次更新了的索引列的字段。都会调整因为更新后所带来的键值变化后的所有信息
- 索引只是提高效率的一个因素，如果你的MYSQL有大数据量的表，就要花时间研究建立最优秀的索引，或优化查询

## 索引类型

### 单值索引

即一个索引只包含单个列，一个表可以有多个单子索引

### 唯一索引

索引列必须唯一，但允许有空值

### 复合索引

即一个索引包含多个列



## 索引结构

- Btree索引
- Hash索引
- Full-text全文索引
- R-Tree索引

那些情况下需要建立索引：

- 主键自动建立唯一索引
- 频繁作为查询条件的字段
- 查询中与其它表关联的字段，外键关键建立索引
- 频繁更新的字段不适合创建索引
- Where 条件用不到的字段不要建立索引
- 一般优先选择符合索引
- 查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度
- 查询中统计或者分组字段

那些情况不要建立索引

- 表记录太少
- 经常增删改
- 数据重复且平均分配的表字段。

## Join语句优化

尽可能减少Join中的NestedLoop的循环次数：“永远使用小的结果集驱动大的结果集”

优先优化内层循环

保证Join语句中被驱动表Join条件字段已经被索引

当无法保证被驱动表的Join条件字段被索引且内存资源足够，不要太吝啬JoinBuffer的设置

## 索引失效

- 最佳左前缀法则（左边某一索引不使用到，后面所有索引失效，因此最好使用全值匹配）

- 不在索引列上做任何操作（计算、函数、自动或手动类型转换）会导致索引失效而转向全表扫描

- 存储引擎不能使用索引中范围条件的右边的列

- 尽量使用覆盖索引（只访问索引的查询（索引列和查询列一致）），减少select *;

- Mysql 在使用不等与（!=，<>）的时候无法使用索引而导致全表扫描

- is null ,is not null也会导致索引失效

- like以通配符开头（‘%abc...’）mysql索引失效而表成全表扫描操作（%最好加在右边，变成范围扫描）

- 字符串不加单引号索引失效

## myIsam存储引擎与innodb的区别

- MyISAM使用前缀压缩技术使得索引更小，Innodb则按源数据格式存储
- MyISAM索引通过数据的物理位置引用被索引的行，InnoDB则是根据主键引用被索引的行
- 


