# 工作内存与主内存

## Java 的内存模型

- java 的内存模型分为主内存和工作内存，所有线程共享主内存，每个线程都有自己的工作内存，不是共享的。一个线程不能访问另一个线程的工作内存。线程之间通过主内存来实现线程间的通信。
- 线程的工作内存的所需变量是主内存的一份拷贝副本，一个线程对主内存的操作包括（读取、载入、使用，赋值、存储、写入）。多线程间的工作流程如下图：

![内存模型](/内存模型.jpg)

## 内存间的交互模型

 JLS定义了线程对主存的操作指令：**lock，unlock，read，load，use，assign，store，write**。这些行为是不可分解的原子操作，在使用上相互依赖，read-load从主内存复制变量到当前工作内存，use-assign执行代码改变共享变量值，store-write用工作内存数据刷新主存相关内容。

- read（读取）：作用于主内存变量，把一个变量值从主内存传输到线程的工作内存中，以便随后的load动作使用
- load（载入）：作用于工作内存的变量，它把read操作从主内存中得到的变量值放入工作内存的变量副本中。
- use（使用）：作用于工作内存的变量，把工作内存中的一个变量值传递给执行引擎，每当虚拟机遇到一个需要使用变量的值的字节码指令时将会执行这个操作。
- assign（赋值）：作用于工作内存的变量，它把一个从执行引擎接收到的值赋值给工作内存的变量，每当虚拟机遇到一个给变量赋值的字节码指令时执行这个操作。
- store（存储）：作用于工作内存的变量，把工作内存中的一个变量的值传送到主内存中，以便随后的write的操作。
- write（写入）：作用于主内存的变量，它把store操作从工作内存中一个变量的值传送到主内存的变量中。

