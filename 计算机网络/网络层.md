# 网络层

网络层向上只提供简单灵活的，无连接的，尽最大努力交付的数据服务。

网络层不提供服务质量的承诺，也就是说，所传送的分组可能出错，丢失、重复和失序，当然也不保证分组交付的时限。

### 网际协议Ip

![1531832273837](E:\mydairy\计算机网络\网际协议Ip.png)

从一般概念来讲，将网络互相连接起来要使用一些中间设备

- 物理层使用的中间设备是：转发器
- 数据链路层：网桥、桥接器
- 网络层：路由器
- 在网络层以上使用的设备叫做网关

### 分类的IP地址

IP由网络号+主机号组成

![1531832822294](E:\mydairy\计算机网络\IP划分.png)

![1531832877796](E:\mydairy\计算机网络\IP范围.png)

### IP地址与硬件地址

- 从层次的角度看，物理地址是数据链路层和物理层使用的地址，而IP 地址是网络层和以上各层使用的地址，是一种逻辑地址
- 在发送数据时，数据从高层下到低层，然后才到通信链路上传输。使用IP地址的IP数据报一旦交个了数据链路层，就被封装成MAC帧，MAC帧在传输时使用的是源地址和目的地址都是·硬件地址，这两个地址写在MAC地址的首部

### 地址解析协议ARP

把IP转化为MAC地址

![1531833886405](E:\mydairy\计算机网络\ARP协议.png)

地址解析协议ARP中，每个主机都设有一个ARP高速缓存，里面有本局域网上的各主机的路由器的IP到硬件地址的映射表。

### IP数据报的格式

![1531835802768](E:\mydairy\计算机网络\IP数据报格式.png)

1. **版本** 占4位，指协议的版本（IPV4 OR IPV6）

2. **首部长度**  占4位，可表示最大十进制数值15.请注意，首部长度字段所表示的单位是32个字（1个32位字长是4字节），因此，首部长度字段的最小值是5，相当于IP首部长度5 X 4=20字节。当首部长度为1111时，首部长度就达到了最大值15个32位字长，即60个字节。

3. **区分服务** 占8位，用来获得更好的服务。这个字段在就标准中叫服务类型，但实际上一直没有被用过。

4. **总长度** 总长度指首部和数据之和的长度，单位字节，总长度字段占16位，因此数据报的最大长度是2^16-1=65535字节。然而实际上传送这么长的数据报在现实中是极少遇到的。（数据链路层协议规定，一个数据帧中的数据字段的最大长度，这称为最大传送单元MTU，通常是1500字节），当一个数据报封装成帧的长度大于这个MTU就必须把过长的数据进行分片处理。在进行分片时，数据报首部中的“总长度”字段是指分片后每个分片的首部与该分片的数据长度的总和

5. **标识** 占16位，IP软件存储器中维持一个计数器，没产生一个数据报，计数就加1.用于分片的数据报，标识相同就组合，组合成一个完整的IP数据报

6. **标志** 占3位，但目前只有两位有意义

   - 标识字段中最低为记为MF，MF=1，即表示后面“**还有分片**”的数据报。为0，表示是分片的最后一个
   - 标识字段中间意味记为DF，意思是“不能分片”，只有当DF为0时才允许分片

7. **片偏移** 占13位，片偏移指出：较长的分组在分片后，某片在原分组中的相对位置。。片偏移以8个字节为偏移单位。所有每个分片的长度一定是8的整数倍

8. **生存时间** 占8位，表明是数据报在网络的寿命。

9. **协议** 占8位，指明使用何种协议

   ![1531837997117](E:\mydairy\计算机网络\IP协议类型.png)

10. **首部校验和** 占16位。这个字段只检验数据报的首部，但不包含数据部分。

11. **源地址** 占32位

12. **目的地址** 占32位

   ###  IP数据报首部的可变部分

是可选字段，可以用来支持排错，测量，以及安全等措施，内容丰富，从一个字节到40个字节不等，取决于所选择的目的。

### 路由表

（**目的网络地址，下一跳地址**）